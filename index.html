<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Coding Advent Calendar</title>
    <style>
        :root {
            --bg-color: #050a14;
            --panel-bg: #0a1122;
            --neon-green: #0f0;
            --neon-red: #ff003c;
            --neon-blue: #00f3ff;
            --neon-amber: #ffae00;
            --text-main: #c0c0c0;
            --font-code: 'Courier New', Courier, monospace;
            --font-ui: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-ui);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Scanline Effect */
        body::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 255, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* Candlelight Overlay */
        #candle-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
            background: radial-gradient(circle at 50% 80%, rgba(255, 200, 150, 0.25) 0%, rgba(0, 0, 0, 0.9) 65%);
            animation: candleFlicker 4s infinite;
        }

        @keyframes candleFlicker {
            0% { opacity: 0.75; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        h1 {
            color: var(--neon-blue);
            text-transform: uppercase;
            text-shadow: 0 0 10px var(--neon-blue);
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-align: center;
            z-index: 3;
        }

        .system-status {
            font-family: var(--font-code);
            color: var(--neon-green);
            font-size: 0.9em;
            margin-bottom: 20px;
            text-align: center;
            z-index: 3;
        }

        .mission-brief {
            background: var(--panel-bg);
            border: 1px solid var(--neon-green);
            padding: 15px;
            max-width: 800px;
            width: 100%;
            margin-bottom: 20px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.1);
            z-index: 3;
        }

        .brief-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--neon-green);
            font-weight: bold;
        }

        .brief-content {
            display: none;
            margin-top: 10px;
            border-top: 1px dashed var(--neon-green);
            padding-top: 10px;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .brief-content.open { display: block; }
        .highlight { color: var(--neon-amber); font-weight: bold; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            max-width: 900px;
            width: 100%;
            margin-bottom: 40px;
            z-index: 3;
        }

        .day-card {
            background: var(--panel-bg);
            border: 1px solid #333;
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            cursor: not-allowed;
            position: relative;
            transition: all 0.3s ease;
            color: #555;
            font-family: var(--font-code);
        }

        .day-card.locked { opacity: 0.5; }
        .day-card.active {
            border-color: var(--neon-amber);
            color: var(--neon-amber);
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 174, 0, 0.3);
            animation: pulse 2s infinite;
        }

        .day-card.active:hover {
            transform: scale(1.05);
            background: #1a233a;
        }

        .day-card.solved {
            border-color: var(--neon-green);
            color: var(--neon-green);
            animation: none;
            box-shadow: inset 0 0 10px rgba(0,255,0,0.2);
        }
        .day-card.solved::after {
            content: '✓';
            position: absolute;
            bottom: 5px; right: 5px;
            font-size: 0.6em;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(255, 174, 0, 0.2); }
            50% { box-shadow: 0 0 20px rgba(255, 174, 0, 0.6); }
            100% { box-shadow: 0 0 5px rgba(255, 174, 0, 0.2); }
        }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

        .modal-content {
            background: var(--panel-bg);
            border: 2px solid var(--neon-blue);
            padding: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
        }

        .close-btn {
            position: absolute;
            top: 10px; right: 15px;
            color: var(--neon-red);
            font-size: 1.5em;
            cursor: pointer;
            border: none;
            background: none;
        }

        .code-container {
            background: #000;
            padding: 15px;
            border-left: 3px solid var(--neon-blue);
            font-family: var(--font-code);
            font-size: 0.9em;
            white-space: pre-wrap;
            line-height: 1.6;
            margin: 15px 0;
            color: #ddd;
        }

        input.code-input {
            background: #222;
            border: 1px solid #555;
            color: var(--neon-amber);
            font-family: var(--font-code);
            width: 80px;
            text-align: center;
            padding: 2px;
            margin: 0 2px;
            text-transform: uppercase;
        }

        input.code-input.correct { border-color: var(--neon-green); color: var(--neon-green); background: #051405; }
        input.code-input.wrong { border-color: var(--neon-red); animation: shake 0.3s; }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .btn {
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 8px 16px;
            cursor: pointer;
            font-family: var(--font-ui);
            text-transform: uppercase;
            margin-right: 10px;
            transition: 0.2s;
            margin-top: 10px;
        }

        .btn:hover { background: rgba(0, 243, 255, 0.2); }
        .btn-check { border-color: var(--neon-green); color: var(--neon-green); }
        .btn-check:hover { background: rgba(0, 255, 0, 0.2); }

        .hint-area {
            margin-top: 15px;
            padding: 10px;
            border: 1px dashed #555;
            display: none;
            font-size: 0.9em;
            color: #aaa;
        }

        .line-item {
            background: #111;
            padding: 5px;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            border: 1px solid #333;
        }
        .line-controls { display: flex; flex-direction: column; margin-right: 10px; }
        .control-arrow {
            cursor: pointer; font-size: 0.8em; color: var(--neon-blue);
            user-select: none;
        }
        .control-arrow:hover { color: #fff; }

        .success-overlay {
            display: none;
            text-align: center;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .secret-char {
            font-size: 4em;
            color: var(--neon-green);
            text-shadow: 0 0 20px var(--neon-green);
            margin: 20px 0;
            font-family: var(--font-code);
            border: 2px solid var(--neon-green);
            display: inline-block;
            padding: 10px 30px;
        }

        .next-challenge-msg {
            color: var(--text-main);
            font-style: italic;
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 10px;
        }

        .grand-victory {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 200;
            justify-content: center;
        }

        /* Neon animated border for victory screen */
        #victory-screen {
            border: 4px solid transparent;
            animation: neonBorder 3s infinite alternate;
        }

        @keyframes neonBorder {
            0%   { box-shadow: 0 0 10px #ff003c, inset 0 0 10px #ff003c; }
            25%  { box-shadow: 0 0 15px #00ff00, inset 0 0 15px #00ff00; }
            50%  { box-shadow: 0 0 15px #00f3ff, inset 0 0 15px #00f3ff; }
            75%  { box-shadow: 0 0 20px #ffd700, inset 0 0 20px #ffd700; }
            100% { box-shadow: 0 0 25px #ffffff, inset 0 0 25px #ffffff; }
        }

        .xmas-text {
            font-family: 'Brush Script MT', cursive;
            font-size: 4em;
            background: linear-gradient(to right, var(--neon-red), var(--neon-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }

        /* --- CONFETTI --- */
        .confetti-piece {
            position: fixed;
            top: -10px;
            width: 8px;
            height: 14px;
            opacity: 0.9;
            z-index: 999;
            animation: fallConfetti linear forwards;
        }
        @keyframes fallConfetti {
            to { transform: translateY(120vh) rotate(720deg); }
        }

        /* --- SNOWFALL --- */
        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 12px;
            opacity: 0.8;
            animation: snowfall linear forwards;
            user-select: none;
            z-index: 500;
        }
        @keyframes snowfall {
            to { transform: translateY(110vh); }
        }

        /* --- VICTORY SPARKLES --- */
        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(white, transparent);
            border-radius: 50%;
            animation: sparkleAnim 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }
        @keyframes sparkleAnim {
            0%   { opacity: 1;   transform: scale(0.2); }
            50%  { opacity: 0.8; transform: scale(1.3); }
            100% { opacity: 0;   transform: scale(0.1); }
        }

        /* --- FALLING PRESENTS --- */
        .present {
            position: fixed;
            top: -40px;
            width: 26px;
            height: 26px;
            border-radius: 4px;
            box-shadow: 0 0 6px rgba(0,0,0,0.7);
            z-index: 700;
            animation: presentFall linear forwards;
        }
        .present::before,
        .present::after {
            content: "";
            position: absolute;
            background: rgba(255,255,255,0.8);
        }
        .present::before {
            width: 4px;
            height: 100%;
            left: 50%;
            top: 0;
            transform: translateX(-50%);
        }
        .present::after {
            height: 4px;
            width: 100%;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
        }
        @keyframes presentFall {
            to { transform: translateY(120vh) rotate(360deg); }
        }

        /* --- PIXEL-ART SPRITES (32x32) --- */
        .pixel-sprite {
            position: absolute;
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
            z-index: 300;
        }
        .sprite-tree {
            background:
                linear-gradient(#0b3, #0b3),
                linear-gradient(#0b3, #0b3),
                linear-gradient(#0b3, #0b3),
                linear-gradient(#630, #630);
            background-repeat: no-repeat;
            background-size:
                24px 10px,
                18px 10px,
                12px 10px,
                8px 8px;
            background-position:
                4px 2px,
                7px 10px,
                10px 18px,
                12px 24px;
        }
        .sprite-santa {
            background:
                linear-gradient(#f00, #f00),
                linear-gradient(#fff, #fff),
                linear-gradient(#fcc, #fcc),
                linear-gradient(#fff, #fff);
            background-repeat: no-repeat;
            background-size:
                24px 10px,
                26px 4px,
                20px 10px,
                24px 6px;
            background-position:
                4px 2px,
                3px 0px,
                6px 10px,
                4px 20px;
        }
        .sprite-present {
            background-color: #c00;
            border: 4px solid #700;
            box-shadow: inset 0 0 0 3px #ffa500;
        }
        .sprite-star {
            background:
                radial-gradient(circle, #ffd700 0, #ffd700 40%, transparent 41%);
        }

        /* Falling pixel sprites */
        .falling-sprite {
            animation: spriteFall linear forwards;
        }
        @keyframes spriteFall {
            to { transform: translateY(115vh); }
        }

    </style>
</head>
<body>

    <div id="candle-overlay"></div>

    <h1>Nexus Coding Advent</h1>
    <div class="system-status">
        LOCATION: MALAYSIA NODE (UTC+8)<br>
        DATE: <span id="current-date">Loading...</span>
    </div>

    <div class="mission-brief">
        <div class="brief-header" onclick="toggleBrief()">
            <span>>> MISSION BRIEFING (CLICK TO EXPAND)</span>
            <span>[+]</span>
        </div>
        <div class="brief-content" id="brief-content">
            <p>Welcome, Coder! Every day, a new puzzle unlocks based on Malaysian Time.</p>
            <ul>
                <li><strong>Days 1-24:</strong> Fill in the missing keywords (e.g., IF, WHILE, INTEGER).</li>
            </ul>
            <p class="highlight">IMPORTANT: When you solve a puzzle, you receive a SECRET NUMBER. WRITE THIS DOWN!</p>
            <p><strong>Victory Condition:</strong> At the end of Day 24, you will use your collection of numbers to unlock the Final Password.</p>
        </div>
    </div>

    <div class="calendar-grid" id="calendar-grid"></div>

    <div class="modal-overlay" id="puzzle-modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">×</button>
            <h2 id="modal-title" style="color:var(--neon-blue); margin-top:0;">DAY X</h2>
            <p id="modal-question" style="color: #fff; font-style: italic;"></p>

            <div id="puzzle-area"></div>

            <div id="controls-area" style="margin-top: 15px;">
                <button class="btn btn-check" onclick="checkAnswer()">Compile & Run</button>
            </div>

            <div id="hint-box" class="hint-area">
                <strong>HINT BANK:</strong> <span id="word-bank"></span>
                <br><br>
                <button class="btn" id="reveal-btn" style="font-size: 0.8em;" onclick="revealKeyword()">Reveal One Keyword (Emergency)</button>
            </div>

            <div id="success-msg" class="success-overlay">
                <h3 style="color:var(--neon-green)">COMPILATION SUCCESSFUL!</h3>
                <p>Your Secret Number for today is:</p>
                <div class="secret-char" id="secret-display">?</div>
                <p style="color:var(--neon-amber)">Write this number down!</p>
                <p class="next-challenge-msg">See you tomorrow for the next challenge!</p>
            </div>
        </div>
    </div>

    <div class="grand-victory" id="victory-screen">
        <div class="xmas-text">Merry Christmas!</div>
        <p style="color: #fff; max-width: 600px;">System Unlocked. Protocol: FESTIVE_OVERRIDE initiated.</p>
        <button class="btn btn-check" style="font-size: 1.2em; padding: 15px 30px;" onclick="playJingleBells()">♫ Play Jingle Bells ♫</button>
        <br><br>
        <button class="btn" onclick="location.reload()">Reset System</button>
    </div>

    <script>
        const KEYWORDS = [
            "DECLARE","INTEGER","STRING","BOOLEAN","REAL","CHAR","ARRAY","OF",
            "FOR","TO","NEXT","WHILE","DO","ENDWHILE","REPEAT","UNTIL",
            "IF","THEN","ELSE","ELSEIF","ENDIF","OUTPUT","INPUT","MOD","DIV",
            "AND","OR","NOT","TRUE","FALSE","FUNCTION","PROCEDURE","RETURN",
            "CALL","ENDPROCEDURE","ENDFUNCTION","CASE","OTHERWISE","ENDCASE",
            "ROUND","RANDOM","LENGTH","SUBSTRING","UCASE"
        ];

        // Puzzles: Day 5 uses s:'147' for Ë
        const puzzles = [
            {
                d:1,
                s:'71',
                q:"Ask for name, output greeting.",
                c:'OUTPUT "Enter your name:"\nINPUT Name\nOUTPUT "Merry Christmas, ", Name, "!"'
            },
            {
                d:2,
                s:'69',
                q:"Store mince pies in variable and display.",
                c:'DECLARE Number : INTEGER\nOUTPUT "How many mince pies did you eat?"\nINPUT Number\nOUTPUT "You ate ", Number, " mince pies!"'
            },
            {
                d:3,
                s:'83',
                q:"Calculate full boxes (6 per box) and leftovers.",
                c:'DECLARE Chocolates, Boxes, Leftover : INTEGER\nOUTPUT "Enter total chocolates:"\nINPUT Chocolates\nBoxes ← Chocolates DIV 6\nLeftover ← Chocolates MOD 6\nOUTPUT "Full boxes: ", Boxes\nOUTPUT "Leftovers: ", Leftover'
            },
            {
                d:4,
                s:'69',
                q:"Calculate turkey price with 5% tax, rounded to 2 decimals.",
                c:'DECLARE Price, FinalPrice : REAL\nOUTPUT "Enter turkey price:"\nINPUT Price\nFinalPrice ← Price * 1.05\nOUTPUT "Final Price: ", ROUND(FinalPrice, 2)'
            },

            // Day 5 – Naughty Reindeer Counter
            {
                d:5,
                s:'147',
                q:'<strong>Puzzle 5 – Naughty Reindeer Counter</strong><br>' +
                  'DESCRIPTION: This algorithm asks repeatedly whether each reindeer is naughty or not, and counts how many are naughty. Input must be 0 or 1 for each reindeer.<br>' +
                  'SAMPLE INPUT: 1 0 1 1 0<br>' +
                  'SAMPLE OUTPUT: Total naughty reindeer = 3',
                c:`DECLARE NaughtyCount : INTEGER
NaughtyCount ← 0
FOR R ← 1 TO 5
    REPEAT
        OUTPUT "Is reindeer ", R, " naughty? (1=yes, 0=no)"
        INPUT Answer
    UNTIL Answer = 0 OR Answer = 1
    IF Answer = 1 THEN
        NaughtyCount ← NaughtyCount + 1
    ENDIF
NEXT R
OUTPUT "Total naughty reindeer = ", NaughtyCount`
            },

            // Day 6 – Elf Candy Collector
            {
                d:6,
                s:'78',
                q:'<strong>Puzzle 6 – Elf Candy Collector</strong><br>' +
                  'DESCRIPTION: This algorithm repeatedly adds candy to an elf’s stash until they have enough to be satisfied.<br>' +
                  'SAMPLE INPUT: 5<br>' +
                  'SAMPLE OUTPUT: Elf 3 finally has enough candy!',
                c:`DECLARE Candy : INTEGER
DECLARE ElfNumber : INTEGER
ElfNumber ← 1
INPUT Candy
WHILE Candy < 10 DO
    OUTPUT "Elf ", ElfNumber, " needs more candy!"
    Candy ← Candy + 2
    ElfNumber ← ElfNumber + 1
ENDWHILE
OUTPUT "Elf ", ElfNumber, " finally has enough candy!"`
            },

            // Day 7 – Christmas Carol Selector
            {
                d:7,
                s:'68',
                q:'<strong>Puzzle 7 – Christmas Carol Selector</strong><br>' +
                  'DESCRIPTION: Chooses a Christmas carol to play depending on the user’s mood.<br>' +
                  'SAMPLE INPUT: happy<br>' +
                  'SAMPLE OUTPUT: Play: Jingle Bells',
                c:`DECLARE Mood : STRING
INPUT Mood
IF Mood = "happy" THEN
    OUTPUT "Play: Jingle Bells"
ELSE
    IF Mood = "calm" THEN
        OUTPUT "Play: Silent Night"
    ELSE
        OUTPUT "Play: Deck the Halls"
    ENDIF
ENDIF`
            },

            // Day 8 – Christmas Eve Countdown
            {
                d:8,
                s:'69',
                q:'<strong>Puzzle 8 – Christmas Eve Countdown</strong><br>' +
                  'DESCRIPTION: Prints a countdown of hours left until it is time to bake cookies.<br>' +
                  'SAMPLE INPUT: (no input)<br>' +
                  'SAMPLE OUTPUT: 24 hours... 21 hours... 18 hours...',
                c:`DECLARE Timer : INTEGER
FOR Timer ← 24 TO 0 STEP -3
    OUTPUT Timer, " hours left to bake cookies!"
NEXT Timer
OUTPUT "It is time to bake Christmas Eve cookies!"`
            },

            // Day 9 – Gift Search in Santa’s Bag
            {
                d:9,
                s:'32',
                q:'<strong>Puzzle 9 – Gift Search in Santa’s Bag</strong><br>' +
                  'DESCRIPTION: Stores a list of gifts, then checks if a target gift is in the bag.<br>' +
                  'SAMPLE INPUT: Gifts: Train, Ball, Doll, Book, Car; Target: Book<br>' +
                  'SAMPLE OUTPUT: TRUE',
                c:`DECLARE Gifts : ARRAY[1:5] OF STRING
DECLARE Target : STRING
DECLARE Found : BOOLEAN
Found ← FALSE
FOR i ← 1 TO 5
    INPUT Gifts[i]
NEXT i
INPUT Target
FOR i ← 1 TO 5
    IF Gifts[i] = Target THEN
        Found ← TRUE
    ENDIF
NEXT i
OUTPUT Found`
            },

            // Day 10 – Snowball Growth Simulator
            {
                d:10,
                s:'75',
                q:'<strong>Puzzle 10 – Snowball Growth Simulator</strong><br>' +
                  'DESCRIPTION: The snowball keeps growing by random small amounts until big enough.<br>' +
                  'SAMPLE INPUT: (no input)<br>' +
                  'SAMPLE OUTPUT: Snowball size now: … repeated until ≥ 10',
                c:`DECLARE Size : INTEGER
Size ← 1
REPEAT
    Size ← Size + ROUND(RANDOM() * 3, 0)
    OUTPUT "Snowball size now: ", Size
UNTIL Size >= 10
OUTPUT "The snowball is ready!"`
            },

            // Day 11 – Extract First Word of Christmas Wish
            {
                d:11,
                s:'69',
                q:'<strong>Puzzle 11 – Extract First Word of Christmas Wish</strong><br>' +
                  'DESCRIPTION: Extracts the first word from a Christmas wish.<br>' +
                  'SAMPLE INPUT: "Merry Christmas Santa"<br>' +
                  'SAMPLE OUTPUT: Merry',
                c:`DECLARE Wish : STRING
DECLARE FirstWord : STRING
DECLARE Pos : INTEGER
INPUT Wish
Pos ← LENGTH(Wish)
WHILE Pos > 0 AND SUBSTRING(Wish, Pos, 1) <> " " DO
    Pos ← Pos - 1
ENDWHILE
FirstWord ← SUBSTRING(Wish, 1, Pos - 1)
OUTPUT FirstWord`
            },

            // Day 12 – Sleigh Route Chooser
            {
                d:12,
                s:'82',
                q:'<strong>Puzzle 12 – Sleigh Route Chooser</strong><br>' +
                  'DESCRIPTION: Selects a sleigh route based on a direction input.<br>' +
                  'SAMPLE INPUT: N<br>' +
                  'SAMPLE OUTPUT: North Pole route selected.',
                c:`DECLARE Route : CHAR
INPUT Route
CASE OF Route
    'N' : OUTPUT "North Pole route selected."
    'S' : OUTPUT "South Village route selected."
    'E' : OUTPUT "East Forest route selected."
    'W' : OUTPUT "West Mountain route selected."
    OTHERWISE OUTPUT "Invalid route!"
ENDCASE`
            },

            // Day 13 – Light Brightness Grid
            {
                d:13,
                s:'83',
                q:'<strong>Puzzle 13 – Light Brightness Grid</strong><br>' +
                  'DESCRIPTION: Stores a 3×3 grid of Christmas light brightness levels.<br>' +
                  'SAMPLE INPUT: 9 values such as 3 4 2 …<br>' +
                  'SAMPLE OUTPUT: Brightness at (2,3): X',
                c:`DECLARE Lights : ARRAY[1:3,1:3] OF INTEGER
FOR R ← 1 TO 3
    FOR C ← 1 TO 3
        INPUT Lights[R,C]
    NEXT C
NEXT R
OUTPUT "Brightness at (2,3): ", Lights[2,3]`
            },

            // Day 14 – Santa’s Gift Matching
            {
                d:14,
                s:'70',
                q:'<strong>Puzzle 14 – Santa’s Gift Matching</strong><br>' +
                  'DESCRIPTION: Matches each child with the gift assigned to them.<br>' +
                  'SAMPLE INPUT: Names: Ana, Bo, Chen; Gifts: Bear, Ball, Book; Target: Bo<br>' +
                  'SAMPLE OUTPUT: Ball',
                c:`DECLARE Names : ARRAY[1:3] OF STRING
DECLARE Gifts : ARRAY[1:3] OF STRING
FOR i ← 1 TO 3
    INPUT Names[i]
    INPUT Gifts[i]
NEXT i
INPUT Target
FOR i ← 1 TO 3
    IF Names[i] = Target THEN
        OUTPUT Gifts[i]
    ENDIF
NEXT i`
            },

            // Day 15 – Christmas Tree Builder
            {
                d:15,
                s:'69',
                q:'<strong>Puzzle 15 – Christmas Tree Builder</strong><br>' +
                  'DESCRIPTION: Builds a simple Christmas tree pattern of stars.<br>' +
                  'SAMPLE INPUT: 4<br>' +
                  'SAMPLE OUTPUT: *, **, ***, ****',
                c:`DECLARE Rows : INTEGER
INPUT Rows
FOR R ← 1 TO Rows
    FOR S ← 1 TO R
        OUTPUT "*";
    NEXT S
    OUTPUT ""
NEXT R`
            },

            // Day 16 – Packing Gifts Until Bag Full
            {
                d:16,
                s:'69',
                q:'<strong>Puzzle 16 – Packing Gifts Until Bag Full</strong><br>' +
                  'DESCRIPTION: Packs groups of small gifts until the bag is filled to 20.<br>' +
                  'SAMPLE INPUT: (no input)<br>' +
                  'SAMPLE OUTPUT: "Packed small gift..." repeated until bag is full',
                c:`DECLARE Bag : INTEGER
Bag ← 0
WHILE Bag < 20 DO
    FOR i ← 1 TO 3
        Bag ← Bag + 2
        OUTPUT "Packed small gift. Bag=", Bag
    NEXT i
ENDWHILE
OUTPUT "Bag is full!"`
            },

            // Day 17 – Christmas Light Tester
            {
                d:17,
                s:'83',
                q:'<strong>Puzzle 17 – Christmas Light Tester</strong><br>' +
                  'DESCRIPTION: Tests each bulb, asking repeatedly until valid input (0 or 1).<br>' +
                  'SAMPLE INPUT: 1 0 1 1 0<br>' +
                  'SAMPLE OUTPUT: Bulb OK / Replace bulb messages',
                c:`DECLARE Working : BOOLEAN
FOR Bulb ← 1 TO 5
    REPEAT
        OUTPUT "Is bulb ", Bulb, " working? (1=yes,0=no)"
        INPUT X
    UNTIL X = 0 OR X = 1
    IF X = 1 THEN
        OUTPUT "Bulb OK"
    ELSE
        OUTPUT "Replace bulb ", Bulb
    ENDIF
NEXT Bulb`
            },

            // Day 18 – Reindeer Team Assigner
            {
                d:18,
                s:'32',
                q:'<strong>Puzzle 18 – Reindeer Team Assigner</strong><br>' +
                  'DESCRIPTION: Assigns each reindeer a random team number from 0–2.<br>' +
                  'SAMPLE INPUT: (no input)<br>' +
                  'SAMPLE OUTPUT: "Reindeer 1 assigned to team 2" … etc.',
                c:`DECLARE ID : INTEGER
DECLARE Team : INTEGER
FOR R ← 1 TO 6
    ID ← ROUND(RANDOM() * 100, 0)
    Team ← ID MOD 3
    OUTPUT "Reindeer ", R, " assigned to team ", Team
NEXT R`
            },

            // Day 19 – Delivery Mode Chooser
            {
                d:19,
                s:'65',
                q:'<strong>Puzzle 19 – Delivery Mode Chooser</strong><br>' +
                  'DESCRIPTION: Chooses how Santa should travel based on weather conditions.<br>' +
                  'SAMPLE INPUT: snow<br>' +
                  'SAMPLE OUTPUT: Use Rudolph with bright nose',
                c:`DECLARE Weather : STRING
INPUT Weather
IF Weather = "snow" OR Weather = "fog" THEN
    OUTPUT "Use Rudolph with bright nose"
ELSE
    IF Weather = "clear" AND TIME < 20 THEN
        OUTPUT "Use silent glider mode"
    ELSE
        OUTPUT "Use normal sleigh"
    ENDIF
ENDIF`
            },

            // Day 20 – Largest Snowflake Finder
            {
                d:20,
                s:'76',
                q:'<strong>Puzzle 20 – Largest Snowflake Finder</strong><br>' +
                  'DESCRIPTION: Reads 5 snowflake sizes and outputs the largest.<br>' +
                  'SAMPLE INPUT: 4 9 3 6 8<br>' +
                  'SAMPLE OUTPUT: Largest snowflake = 9',
                c:`DECLARE Size : ARRAY[1:5] OF INTEGER
DECLARE MaxSize : INTEGER
MaxSize ← 0
FOR i ← 1 TO 5
    INPUT Size[i]
    IF Size[i] > MaxSize THEN
        MaxSize ← Size[i]
    ENDIF
NEXT i
OUTPUT "Largest snowflake = ", MaxSize`
            },

            // Day 21 – Broken Lights Counter
            {
                d:21,
                s:'77',
                q:'<strong>Puzzle 21 – Broken Lights Counter</strong><br>' +
                  'DESCRIPTION: Reads a 3×3 light grid and counts how many bulbs are broken (value = 0).<br>' +
                  'SAMPLE INPUT: 1 0 1 1 1 0 1 1 1<br>' +
                  'SAMPLE OUTPUT: 2',
                c:`DECLARE Lights : ARRAY[1:3,1:3] OF INTEGER
DECLARE Broken : INTEGER
Broken ← 0
FOR R ← 1 TO 3
    FOR C ← 1 TO 3
        INPUT Lights[R,C]
        IF Lights[R,C] = 0 THEN
            Broken ← Broken + 1
        ENDIF
    NEXT C
NEXT R
OUTPUT Broken`
            },

            // Day 22 – Wrapping Paper Calculator
            {
                d:22,
                s:'65',
                q:'<strong>Puzzle 22 – Wrapping Paper Calculator</strong><br>' +
                  'DESCRIPTION: Calculates total wrapping paper needed for a box.<br>' +
                  'SAMPLE INPUT: 2 3 4<br>' +
                  'SAMPLE OUTPUT: Paper needed = 52',
                c:`DECLARE Length, Width, Height : INTEGER
INPUT Length
INPUT Width
INPUT Height
DECLARE Total : INTEGER
Total ← 2*(Length*Width + Width*Height + Length*Height)
OUTPUT "Paper needed = ", Total`
            },

            // Day 23 – Christmas Border Printer (PROCEDURE)
            {
                d:23,
                s:'76',
                q:'<strong>Puzzle 23 – Christmas Border Printer (PROCEDURE)</strong><br>' +
                  'DESCRIPTION: Prints a decorative border above and below a message.<br>' +
                  'SAMPLE INPUT: (no input)<br>' +
                  'SAMPLE OUTPUT: ********************  Merry Christmas!',
                c:`PROCEDURE PrintBorder(Char : CHAR)
    FOR i ← 1 TO 20
        OUTPUT Char;
    NEXT i
    OUTPUT ""
ENDPROCEDURE
CALL PrintBorder('*')
OUTPUT " Merry Christmas! "
CALL PrintBorder('*')`
            },

            // Day 24 – Bauble Calculator (FUNCTION)
            {
                d:24,
                s:'33',
                q:'<strong>Puzzle 24 – Bauble Calculator (FUNCTION)</strong><br>' +
                  'DESCRIPTION: Returns how many baubles are needed for a Christmas tree based on increasing number of baubles per level.<br>' +
                  'SAMPLE INPUT: 4<br>' +
                  'SAMPLE OUTPUT: Total baubles needed = 20',
                c:`FUNCTION Baubles(Levels : INTEGER) RETURNS INTEGER
    DECLARE Total : INTEGER
    Total ← 0
    FOR i ← 1 TO Levels
        Total ← Total + (i * 2)
    NEXT i
    RETURN Total
ENDFUNCTION
INPUT L
OUTPUT "Total baubles needed = ", Baubles(L)`
            }
        ];

        const SECRET_PHRASE = "GESEËNDE KERSFEES ALMAL!";

        let currentDayIndex = 0;
        let attemptCount = 0;
        let day24State = [];
        let bellsInterval = null;

        function getMalaysianDate() {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            return new Date(utc + (3600000 * 8));
        }

        function getStatus() {
            const myDate = getMalaysianDate();
            const isDec = myDate.getMonth() === 11;
            const day = myDate.getDate();

            if (!isDec) {
                if (myDate.getMonth() < 11) return 0;
                if (myDate.getMonth() > 11) return 25;
            }

            if (day >= 23) return 24;
            return day;
        }

        function init() {
            const statusLimit = getStatus();
            const grid = document.getElementById('calendar-grid');
            const dateSpan = document.getElementById('current-date');

            const myDate = getMalaysianDate();
            dateSpan.textContent = myDate.toDateString() + " " + myDate.toLocaleTimeString();

            grid.innerHTML = '';

            for (let i = 1; i <= 24; i++) {
                const card = document.createElement('div');
                card.className = 'day-card';

                if (i <= statusLimit) {
                    card.classList.add('active');
                    card.innerHTML = `<span>${i}</span>`;
                    card.onclick = () => openPuzzle(i);
                } else {
                    card.classList.add('locked');
                    card.innerHTML = `<span>${i}</span>`;
                }
                grid.appendChild(card);
            }

            // Static background pixel sprites
            initBackgroundSprites();
        }

        function toggleBrief() {
            document.getElementById('brief-content').classList.toggle('open');
        }

        function closeModal() {
            document.getElementById('puzzle-modal').style.display = 'none';
        }

        function openPuzzle(day) {
            currentDayIndex = day;
            attemptCount = 0;
            const modal = document.getElementById('puzzle-modal');
            const title = document.getElementById('modal-title');
            const q = document.getElementById('modal-question');
            const area = document.getElementById('puzzle-area');
            const hintBox = document.getElementById('hint-box');
            const successMsg = document.getElementById('success-msg');
            const controls = document.getElementById('controls-area');

            modal.style.display = 'flex';
            title.textContent = `DAY ${day} PROTOCOL`;
            hintBox.style.display = 'none';
            successMsg.style.display = 'none';
            area.innerHTML = '';
            controls.style.display = 'block';

            const pData = puzzles[day - 1];
            q.innerHTML = pData.q;

            let codeHtml = escapeHtml(pData.c);

            KEYWORDS.forEach(kw => {
                const regex = new RegExp(`\\b${kw}\\b`, 'g');
                codeHtml = codeHtml.replace(regex, `<input type="text" class="code-input" data-answer="${kw}" maxlength="${kw.length + 2}">`);
            });

            const codeBlock = document.createElement('div');
            codeBlock.className = 'code-container';
            codeBlock.innerHTML = codeHtml;
            area.appendChild(codeBlock);
        }

        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function checkAnswer() {
            const inputs = document.querySelectorAll('.code-input');
            let allCorrect = true;
            let keywordsNeeded = [];

            inputs.forEach(input => {
                const userVal = input.value.trim().toUpperCase();
                const correctVal = input.dataset.answer;
                keywordsNeeded.push(correctVal);

                if (userVal === correctVal) {
                    input.classList.remove('wrong');
                    input.classList.add('correct');
                    input.readOnly = true;
                } else {
                    input.classList.add('wrong');
                    allCorrect = false;
                }
            });

            if (allCorrect) {
                showSuccess(puzzles[currentDayIndex - 1].s);
            } else {
                handleFailure(keywordsNeeded);
            }
        }

        function handleFailure(keywords) {
            attemptCount++;
            const hintBox = document.getElementById('hint-box');

            if (attemptCount >= 2) {
                hintBox.style.display = 'block';
                const unique = [...new Set(keywords)];
                unique.sort(() => Math.random() - 0.5);
                document.getElementById('word-bank').textContent = unique.join(", ");
            }
        }

        function revealKeyword() {
            const inputs = document.querySelectorAll('.code-input');
            for (let input of inputs) {
                if (!input.classList.contains('correct')) {
                    input.value = input.dataset.answer;
                    input.classList.remove('wrong');
                    break;
                }
            }
        }

        function showSuccess(char) {
            const msg = document.getElementById('success-msg');
            const display = document.getElementById('secret-display');
            const controls = document.getElementById('controls-area');
            const hintBox = document.getElementById('hint-box');

            controls.style.display = 'none';
            hintBox.style.display = 'none';
            msg.style.display = 'block';
            display.textContent = char;

            const cards = document.querySelectorAll('.day-card');
            if (cards[currentDayIndex - 1]) {
                cards[currentDayIndex - 1].classList.add('solved');
            }
        }

        // --- CONFETTI ---
        function launchConfetti() {
            const colors = ["#ff0000", "#00ff00", "#ffd700", "#ffffff"];
            const numPieces = 150;

            for (let i = 0; i < numPieces; i++) {
                const confetti = document.createElement("div");
                confetti.classList.add("confetti-piece");

                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = Math.random() * 100 + "vw";
                const duration = 3 + Math.random() * 3;
                confetti.style.animationDuration = duration + "s";
                confetti.style.animationDelay = (Math.random() * 1.5) + "s";

                confetti.style.width = (6 + Math.random() * 4) + "px";
                confetti.style.height = (10 + Math.random() * 6) + "px";

                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), (duration + 3) * 1000);
            }
        }

        // --- SNOWFALL ---
        function launchSnowfall() {
            const snowCount = 70;

            for (let i = 0; i < snowCount; i++) {
                const snow = document.createElement("div");
                snow.classList.add("snowflake");
                snow.textContent = "❄";

                snow.style.left = Math.random() * 100 + "vw";
                snow.style.fontSize = (10 + Math.random() * 14) + "px";
                snow.style.animationDuration = (4 + Math.random() * 4) + "s";
                snow.style.opacity = 0.5 + Math.random() * 0.5;

                document.body.appendChild(snow);
                setTimeout(() => snow.remove(), 9000);
            }
        }

        // --- SPARKLES ---
        function burstSparkles() {
            const container = document.getElementById("victory-screen");
            const numSparkles = 40;

            const rect = container.getBoundingClientRect();

            for (let i = 0; i < numSparkles; i++) {
                const sparkle = document.createElement("div");
                sparkle.classList.add("sparkle");

                const offsetX = rect.width / 2 + (Math.random() * 200 - 100);
                const offsetY = rect.height / 3 + (Math.random() * 120 - 60);

                sparkle.style.left = offsetX + "px";
                sparkle.style.top = offsetY + "px";

                container.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 1600);
            }
        }

        // --- SANTA HO HO HO ---
        function santaHoHoHo() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const o = ctx.createOscillator();
            const g = ctx.createGain();

            o.type = "square";
            o.frequency.value = 180;
            g.gain.value = 0.0;

            o.connect(g);
            g.connect(ctx.destination);

            const startTime = ctx.currentTime;
            let t = startTime;

            for (let i = 0; i < 3; i++) {
                g.gain.setValueAtTime(0.25, t);
                g.gain.exponentialRampToValueAtTime(0.001, t + 0.25);
                t += 0.35;
            }

            o.start(startTime);
            o.stop(t + 0.1);
        }

        // --- FALLING PRESENTS ---
        function launchPresents() {
            const colors = [
                { base: "#c00000", accent: "#ffcc00" }, // red + gold
                { base: "#008000", accent: "#ff0000" }, // green + red
                { base: "#0044aa", accent: "#d0e8ff" }  // blue + silver
            ];
            const count = 25;

            for (let i = 0; i < count; i++) {
                const p = document.createElement("div");
                p.classList.add("present");

                const style = colors[Math.floor(Math.random() * colors.length)];
                p.style.backgroundColor = style.base;
                p.style.borderColor = style.accent;

                p.style.left = Math.random() * 100 + "vw";
                const duration = 4 + Math.random() * 4;
                p.style.animationDuration = duration + "s";
                p.style.animationDelay = (Math.random() * 2) + "s";

                document.body.appendChild(p);
                setTimeout(() => p.remove(), (duration + 3) * 1000);
            }
        }

        // --- STATIC & FALLING PIXEL SPRITES ---
        function initBackgroundSprites() {
            const types = ["sprite-tree", "sprite-santa", "sprite-present", "sprite-star"];
            const staticCount = 8;

            for (let i = 0; i < staticCount; i++) {
                const sp = document.createElement("div");
                sp.classList.add("pixel-sprite");
                sp.classList.add(types[Math.floor(Math.random() * types.length)]);

                sp.style.left = Math.random() * 100 + "vw";
                sp.style.top = (5 + Math.random() * 80) + "vh";
                sp.style.opacity = 0.55;

                document.body.appendChild(sp);
            }
        }

        function launchSpriteBurst() {
            const types = ["sprite-tree", "sprite-santa", "sprite-present", "sprite-star"];
            const count = 15;

            for (let i = 0; i < count; i++) {
                const sp = document.createElement("div");
                sp.classList.add("pixel-sprite", "falling-sprite");
                sp.classList.add(types[Math.floor(Math.random() * types.length)]);

                sp.style.left = Math.random() * 100 + "vw";
                sp.style.top = "-40px";
                const duration = 4 + Math.random() * 3;
                sp.style.animationDuration = duration + "s";

                document.body.appendChild(sp);
                setTimeout(() => sp.remove(), (duration + 2) * 1000);
            }
        }

        // --- BELLS LOOP ---
        function startBellsLoop() {
            if (bellsInterval) return;

            function playBellOnce() {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const o = ctx.createOscillator();
                const g = ctx.createGain();

                o.type = "sine";
                o.frequency.value = 880; // A5-ish bell
                g.gain.value = 0.001;

                o.connect(g);
                g.connect(ctx.destination);

                const now = ctx.currentTime;
                g.gain.setValueAtTime(0.3, now);
                g.gain.exponentialRampToValueAtTime(0.001, now + 0.5);

                o.start(now);
                o.stop(now + 0.6);
            }

            playBellOnce();
            bellsInterval = setInterval(playBellOnce, 2000);
        }

        // Original Jingle Bells button
        function playJingleBells() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return alert("Audio not supported");
            const ctx = new AudioContext();
            const notes = { E: 329.63, G: 392.00, C: 261.63, D: 293.66, F: 349.23 };
            const melody = [
                {n: 'E', d: 0.2}, {n: 'E', d: 0.2}, {n: 'E', d: 0.4},
                {n: 'E', d: 0.2}, {n: 'E', d: 0.2}, {n: 'E', d: 0.4},
                {n: 'E', d: 0.2}, {n: 'G', d: 0.2}, {n: 'C', d: 0.2}, {n: 'D', d: 0.1}, {n: 'E', d: 0.8}
            ];
            let time = ctx.currentTime;
            melody.forEach(note => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'square';
                osc.frequency.value = notes[note.n];
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(time);
                gain.gain.setValueAtTime(0.1, time);
                gain.gain.exponentialRampToValueAtTime(0.001, time + note.d);
                osc.stop(time + note.d);
                time += note.d + 0.05;
            });
        }

        window.onload = init;
    </script>
</body>
</html>
